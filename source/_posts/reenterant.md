title: リエントアント関数とスレッド安全性
date: 2015-03-05 09:42:29
tags: システム開発
---

リエントアントの定義はなかなか見つけないけど、だいたいのイメージができる。「リエントアント」という名前から見ると、関数を再呼び出すことです。なぜ必要なのかというと、リエントアントではない関数の結果は予想できないのだ。この状況はよくシグナル（他のカーネル実行パスも可能）を発行するとき発生するものだ。

「カーネル実行パスというものは、システムコール、例外、割り込み処理などの実行シーケンスみたいもの」

例えば、a()関数にはいくつのグローバル変数を使っている。a()関数は実行中の際には、あるシステムコールが発行されて、a()関数の実行内容は一旦保存され、システムコールを先に実行する。もしシステムコールにa()関数を呼び出すと、いくつかのグローバル変数を変更する。システムコールを終わってから、a()関数は再開され、結果は予想できなくなる。

リエントアント関数のルールは以下のような３つがある：
①　グローバル変数や静的変数などを使わないように
②　リエントアントではない変数を呼び出さないように

△③データの保護機構を使うこと。(割り込み処理禁止、lockなど)

実際はその３つ目のルールに対しては、ネットで調べた結果、異論があるようだ。
上の③の内容を守っても、リエントアント関数にならない声があるんだ。彼達の観点としては、③の内容を守ったら、スレッド安全だけど、リエントアント関数ではない。

とりあえず、開発するときは、リエントアント関数のルール①と②を守ったら、一番安全だけど、同しようもない場合、ルール③をまもったらいいだと思う。